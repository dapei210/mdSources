以太网子接口


### 二层以太网接口
是一种物理接口，工作在链路层，不能配置IP地址。它可以对接收到的报文进行二层交换转发，可以通过配置各种Access、Hybrid、Trunk和Tunnel这四种端口类型加入一个或多个VLAN中，但只能通过三层的VLANIF接口对接收到的报文进行三层路由转发

### VLAN
VLAN主要解决将大型网络划分为多个小网络，隔离原本在同一个物理LAN中的不同主机的二层通信，使广播流量不会占据更多宽带资源，同时提高网段间的安全性。

要实现不同VLAN间用户互通必须借用三层技术，有两种方法可以实现：
- 在三层交换机上通过VLANIF接口实现
- 在路由器上通过三层以太网接口实现，即单臂路由

传统的三层以太网接口接口不支持VLAN报文，当收到VLAN报文时会当成非法报文而丢弃。为了实现VLAN间的互通，在三层以太网接口上可创建以太网子接口，通过在子接口上部署终结子接口功能将VLAN报文中的VLAN标签剥离掉，从而实现VLAN间的三层互通



#### VLAN 三种端口模式Access,Trunk,Hybrid
1. Access类型的端口只能属于1个VLAN，一般用于连接计算机的端口
2. Trunk类型的端口可以允许多个VLAN通过，可以接收和发送多个VLAN报文，一般用于交换机之间连接的端口
3. Hybrid类型的端口可以允许多个VLAN通过，可以接收和发送多个VLAN的报文，可以用于交换机之间连接，也可以用于连接用户的计算机

Hybrid和Trunk在接收数据时，处理方法是一样的，唯一不同在于发送数据时，Hybrid端口可以允许多个VLAN的报文发送时不打标签，而Trunk端口只允许缺省VLAN的报文发送时不打标签。

#### 单臂路由



#### 端口隔离

实现各接口发送的报文中间的二层隔离，可以将不同的以太网端口加入不同的VLAN，但是会浪费VLAN资源。采用端口隔离，可以实现同一VLAN内端口之间的隔离。用户只需要将端口假如到隔离组中即可，这种隔离是双向的。

#### 光接口和电接口
1. 传输速率不同

常见的光口传输速率可以达到100G以上，常用的电口最高速率只有10G

2. 传输距离不同

光口插入光模块最远传输距离可以到100KM以上，电口连接网线最远传输距离在100米左右

3. 接口类型不同

光口插入光模块或者电口模块，常见的接口类型有LC、SC、MPO和RJ45，电口模块的接口类型只有RJ45


### ACL
访问控制列表ACL（Access Control List）是由一条或多条规则组成的集合。所谓规则，是指描述报文匹配条件的判断语句，这些条件可以是报文的源地址、目的地址、端口号等。
ACL本质上是一种报文过滤器，规则是过滤器的滤芯。设备基于这些规则进行报文匹配，可以过滤出特定的报文，并根据应用ACL的业务模块的处理策略来允许或阻止该报文通过

实现功能如下：
1. 提供安全访问：企业重要服务器资源被随意访问，企业机密信息容易泄露，造成安全隐患。使用ACL可以指定用户访问特定的服务器、网络与服务，从而避免随意访问的情况。
2. 防止网络攻击：Internet病毒肆意侵略企业内网，内网环境的安全性堪忧。使用ACL可以封堵高危端口，从而达成为外网流量的阻塞。
3. 提高网络带宽利用率：网络带宽被各类业务随意挤占，服务质量要求最高的语音、视频业务的带宽得不到保障，造成用户体验差。使用ACL实现对网络流量的精确识别和控制，限制部分网络流量从而保障主要业务的质量

#### ACL分类
1. 基本ACL 

基本ACL规则只包含源IP地址，对设备的CPU消耗较少，可用于简单的部署，但是使用场景有限，不能提供强大的安全保障

2. 高级ACL

相较于基本ACL，高级ACL提供更高的扩展性，可以对流量进行更精细的匹配。通过配置高级ACL，可以阻止特定主机或者整个网段的源或者目标。除此之外，还可以使用协议信息（IP、ICMP、TCP、UDP）去过滤相应的流量

3. 二层ACL

在公司的内部网络中，想对特定的终端进行访问权限控制，这时就需要二层ACL。使用二层ACL，可以根据源MAC地址、目的MAC地址、802.1p优先级、二层协议类型等二层信息对流量进行管控

4. 用户ACL 

由于企业内部同部门的工作人员的终端不在同一个网段难以管理，需要将其纳入一个用户组，并对其用户组进行访问权限管理，这时候就需要用户ACL。用户ACL在高级ACL的基础上增加了用户组的配置项，可以实现对不同用户组的流量管控

#### ACL使用步骤
1. 设置相应的ACL规则
2. 将ACL应用在相应的设备接口的特定方向（in/out）上

#### 匹配机制
ACL规则的匹配遵循”一旦命中即停止匹配”的机制。当ACL处理数据包时，一旦数据包与某条ACL规则匹配，就会停止匹配，设备根据该条匹配的语句内容决定允许或者拒绝该数据包。如果数据包内容与ACL语句不匹配，那么将依次使用ACL列表中的下一条语句去匹配数据包直到列表的末尾。一般在ACL的列表末尾会有一条隐式的拒绝所有的语句，所以数据包与所有的规则都不匹配的情况下会被直接拒绝。此时设备不会将此数据包流入或流出接口，而是直接将其丢弃

#### 使用场景
1. NAT中使用ACL

通过NAT的端口映射可使得外网访问内部网络。考虑到内部的网络安全，不可能允许所有的外部用户访问内部网络，这时可以设置ACL规则并应用在企业路由器上，使得特定的外网用户可以访问内部网络

2. 防火墙中使用ACL

防火墙用在内外网络边缘处，防止外部网络对内部网络的入侵，也可以用来保护网络内部大型服务器和重要的资源（如数据）。由于ACL直接在设备的转发硬件中配置，在防火墙中配置ACL在保护网络安全的同时不会影响服务器的性能

3. QoS中使用ACL限制用户互访
 
ACL应用在QoS的流策略中，可以实现不同网段用户之间访问权限的限制，从而避免用户之间随意访问形成安全隐患

### NAC(华为)
#### AAA
交换机通过域进行AAA用户管理，每个域下可以应用不同的认证、授权和计费方案，以及RADIUS或者HWTACACS服务器模板，相当于对用户进行分类管理。所以在AAA方案配置中，一定要在对应的域下被绑定、应用才能对具体用户生效。域分隔符可以是"\/:<>|@'%"

配置RADIUS认证授权计费流程：配置AAA方案--->配置RADIUS服务器模板--->(配置业务方案)---> 配置域的AAA方案

配置AAA方案
即配置AAA中的认证、授权和计费方案，用于后面将要介绍的"域的AAA方案"中绑定这些方案使用(所配置的各种方案只有在域中绑定后才能得到应用)

配置域的AAA方案





###
单臂路由

交换机堆叠


SNMP






